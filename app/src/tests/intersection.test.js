import * as turf from '@turf/turf';
import performOperation, { INTERSECTION } from 'utils/performOperation';

const square = turf.polygon([
  [
    [2.2919046878814697, 48.85770582708133],
    [2.293460369110107, 48.85676699291116],
    [2.29689359664917, 48.85901169495529],
    [2.2952628135681152, 48.860091657242556],
    [2.2919046878814697, 48.85770582708133],
  ],
]);

const triangle = turf.polygon([
  [
    [2.295616865158081, 48.854776323867306],
    [2.299962043762207, 48.85766347403937],
    [2.2930634021759033, 48.859195219601766],
    [2.295616865158081, 48.854776323867306],
  ],
]);

const feature1 = turf.polygon([
  [
    [2.3013031482696533, 48.85227022723685],
    [2.301689386367798, 48.85253849146323],
    [2.3020541667938232, 48.852347882818634],
    [2.303706407546997, 48.85345622663062],
    [2.3034167289733887, 48.853703306301384],
    [2.3037922382354736, 48.85392214727714],
    [2.2998225688934326, 48.85644933826542],
    [2.299565076828003, 48.85541871153572],
    [2.2990500926971436, 48.85506575229865],
    [2.29738712310791, 48.8547480868576],
    [2.3013031482696533, 48.85227022723685],
  ],
]);

const feature2 = turf.polygon([
  [
    [2.2954773902893066, 48.85463513865943],
    [2.297945022583008, 48.85306795611288],
    [2.3024833202362056, 48.85619521309753],
    [2.300165891647339, 48.85765641519554],
    [2.2954773902893066, 48.85463513865943],
  ],
]);

const feature3 = turf.polygon([
  [
    [2.2945010662078857, 48.85822111955489],
    [2.295970916748047, 48.85458572374262],
    [2.297601699829101, 48.85410569058372],
    [2.30088472366333, 48.85637168904543],
    [2.300090789794922, 48.85738111951053],
    [2.2945010662078857, 48.85822111955489],
  ],
]);

const multiPolygon = turf.multiPolygon([
  [
    [
      [2.298662720024396, 48.8587067835814],
      [2.3003745380546547, 48.8590587311522],
      [2.3006479534350603, 48.859879932527235],
      [2.2995424042899515, 48.859574916446405],
      [2.2990906745319535, 48.86011455901689],
      [2.2985081808972154, 48.860489959112726],
      [2.2967131494899036, 48.85987211162529],
      [2.298662720024396, 48.8587067835814],
    ],
  ],
  [
    [
      [2.2991263287945287, 48.86056034418928],
      [2.2991263287945287, 48.860325719789245],
      [2.2995780585525267, 48.860325719789245],
      [2.2995780585525267, 48.86056034418928],
      [2.2991263287945287, 48.86056034418928],
    ],
  ],
]);

it('two shapes', () => {
  expect(performOperation({ operationType: INTERSECTION, features: [square, triangle] })).toEqual({
    geometry: {
      coordinates: [
        [
          [2.293336307826804, 48.85872294268798],
          [2.29419064909734, 48.857244462278246],
          [2.296132149262165, 48.8585138478168],
          [2.2937777896489235, 48.859036599991235],
          [2.293336307826804, 48.85872294268798],
        ],
      ],
      type: 'Polygon',
    },
    properties: {},
    type: 'Feature',
  });
});

it('multiple shapes', () => {
  expect(
    performOperation({ operationType: INTERSECTION, features: [feature1, feature2, feature3] }),
  ).toEqual({
    geometry: {
      coordinates: [
        [
          [
            [2.29738712310791, 48.8547480868576],
            [2.2979846449131087, 48.8543700057441],
            [2.298970677683137, 48.85505058220437],
            [2.29738712310791, 48.8547480868576],
          ],
        ],
        [
          [
            [2.299577797438277, 48.85546962650642],
            [2.300433618593672, 48.85606032871254],
            [2.2998225688934326, 48.85644933826542],
            [2.299577797438277, 48.85546962650642],
          ],
        ],
      ],
      type: 'MultiPolygon',
    },
    properties: {},
    type: 'Feature',
  });
});

it('multiple shapes, reverse direction', () => {
  expect(
    performOperation({ operationType: INTERSECTION, features: [feature3, feature2, feature1] }),
  ).toEqual({
    geometry: {
      coordinates: [
        [
          [
            [2.29738712310791, 48.8547480868576],
            [2.2979846449131096, 48.8543700057441],
            [2.298970677683138, 48.85505058220437],
            [2.29738712310791, 48.8547480868576],
          ],
        ],
        [
          [
            [2.299577797438277, 48.85546962650642],
            [2.3004336185936705, 48.85606032871254],
            [2.2998225688934326, 48.85644933826542],
            [2.299577797438277, 48.85546962650642],
          ],
        ],
      ],
      type: 'MultiPolygon',
    },
    properties: {},
    type: 'Feature',
  });
});

it('no intersection', () => {
  expect(
    performOperation({ operationType: INTERSECTION, features: [square, multiPolygon] }),
  ).toEqual(null);
});
